<div class="container my-4">
  <h4>Mi disponibilidad semanal</h4>
  <p class="text-muted">Agrega una o más franjas por día. Si un día no tiene franjas, quedará cerrado.</p>

  <%= form_with model: @availability, url: suppliers_availabilities_path, class: "row g-2 mb-4" do |f| %>
    <div class="col-12 col-md-3">
      <%= f.label :wday, "Día", class: "form-label" %>
      <%= f.select :wday,
          options_for_select([["Domingo",0],["Lunes",1],["Martes",2],["Miércoles",3],["Jueves",4],["Viernes",5],["Sábado",6]]),
          {}, class: "form-select" %>
    </div>
    <div class="col-6 col-md-3">
      <%= f.label :start_time, "Desde", class: "form-label" %>
      <%= f.time_field :start_time, step: 1800, class: "form-control" %>
    </div>
    <div class="col-6 col-md-3">
      <%= f.label :end_time, "Hasta", class: "form-label" %>
      <%= f.time_field :end_time, step: 1800, class: "form-control" %>
    </div>
    <div class="col-12 col-md-3 align-self-end">
      <%= f.submit "Agregar franja", class: "btn btn-primary w-100 rounded-4" %>
    </div>
  <% end %>

  <% grouped = @availabilities.group_by(&:wday) %>
  <% (0..6).each do |w| %>
    <div class="card mb-2">
      <div class="card-body d-flex align-items-center justify-content-between">
        <strong class="me-2">
          <%= ["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][w] %>
        </strong>
        <div class="d-flex flex-wrap gap-2">
          <% (grouped[w] || []).each do |a| %>
            <span class="badge text-bg-light border">
              <%= a.start_time.strftime("%H:%M") %>–<%= a.end_time.strftime("%H:%M") %>
              <%= link_to "×", suppliers_availabilities_path(id: a.id), data: { turbo_method: :delete, turbo_confirm: "¿Eliminar franja?" }, class: "ms-2 text-danger text-decoration-none" %>
            </span>
          <% end %>
          <% if (grouped[w] || []).empty? %>
            <span class="text-muted">Sin franjas</span>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
